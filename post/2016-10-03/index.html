	<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.19" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
  <title>Swift 不同Controller互動 與 Navigation Bar &middot; Denny&#39;s Blog</title>
  

  
  <link rel="stylesheet" href="https://cdfq152313.github.io/css/poole.css">
  <link rel="stylesheet" href="https://cdfq152313.github.io/css/syntax.css">
  <link rel="stylesheet" href="https://cdfq152313.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Denny&#39;s Blog" />
</head>

	<body class="theme-base-0f ">
		<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://cdfq152313.github.io/"><h1>Denny&#39;s Blog</h1></a>
      <p class="lead">
       獸控天地 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a> </li>
      
        <li><a href="/categories/notes"> 程式筆記 </a></li>
      
        <li><a href="/categories/misc"> 心得雜感 </a></li>
      
        <li><a href="/tags/"> 標籤列表 </a></li>
      
        <li><a href="/about/"> 關於我 </a></li>
      
    </ul>

    <p>&copy; 2017. All rights reserved. </p>
  </div>
</div>


		<div class="content container">
			<div class="post">
			 	<h1>Swift 不同Controller互動 與 Navigation Bar</h1>
			  <span class="post-date">Mon, Oct 3, 2016</span>
			      

<h1 id="controller之間的呼叫">Controller之間的呼叫</h1>

<h2 id="present-與-dismiss">present 與 dismiss</h2>

<p>想要跳轉頁面，我們可以靠storyBoard拉出present的線，也可以靠程式碼。
在StoryBoard中只要按住ctrl，將button拉到另一個controller後再選present即可。
在程式碼的話</p>

<pre><code class="language-swift">// 因為此ViewController什麼都沒設定，所以會是一片黑
present(ViewController(), animated: true, completion: nil)
</code></pre>

<p>有跳過去，就有返回，想返回時使用dismiss function。</p>

<pre><code class="language-swift">dismiss(animated: true, completion: nil)
</code></pre>

<p>dismiss的原理是，直接呼叫時，請求presentingViewController把你關掉。
間接呼叫時，把後面的presentedViewController們關掉。
至於這兩個是什麼意思請參看下節。</p>

<h2 id="presentingviewcontroller-與-presentedviewcontroller">presentingViewController 與 presentedViewController</h2>

<p>每個controller皆有兩個重要的屬性，可以分辨這個controller是被誰present，或是present了誰。
- presentingViewController：present Controller的Controller
- presentedViewController：被present的Controller</p>

<p>假設ABC皆為Controller，A present B，B present C，那對於B來說。
- A為B之presentingViewController
- C為B之presentedViewController</p>

<h1 id="navigation-bar">Navigation bar</h1>

<h2 id="push-與-pop">push 與 pop</h2>

<p>與present / dismiss相似，進到navigation controller後要使用 navigation屬性的push/pop方法，不然會跳出navigation controller的頁，失去Navigation Bar的效果。</p>

<p>程式碼的形式如下</p>

<pre><code class="language-swift">// 推上下一個頁面
self.navigationController?.pushViewController(ViewController(), animated: true)
// 回到上一頁
self.navigationController?.popViewController(animated: true)
// 直接回到navigation最開頭
self.navigationController?.popToRootViewController(animated: true)
</code></pre>

<h2 id="前後的controller">前後的controller</h2>

<p>如同present / dismiss可以拿到前後關係一樣，navigation controller也是可以拿到前後關係的。
所有經過的controller都放在self.navigationController?.viewControllers這個array裡可以拿取。</p>

<pre><code class="language-swift">self.navigationController?.viewControllers[0]
self.navigationController?.viewControllers[1]
...
</code></pre>

<h2 id="navigation-controller的建立">Navigation Controller的建立</h2>

<p>Navigation Contrller本身並不帶有頁面資訊，而是在Navigation Controller的下一個Controller才會開始顯示。
那兩者之間要建立連線，必須要指定Navigation Controller當中的Root View Controller才行。</p>

<ul>
<li>方法1: Navigation綁定Root Controller，有兩種做法

<ul>
<li>按住Ctrl並將Navigation Controller拉到想要顯示的第一個Controller，鬆開後選擇Root view Controller</li>
<li>在Navigation Controller的Triggered Segue中，指定Root view Controller</li>
</ul></li>
<li>方法2: 在StoryBoard中，點擊已經存在的Controller。並從上方選單Editor =&gt; Embed in =&gt; NavigatioController即可</li>
</ul>

<h2 id="上面的title和向右鈕">上面的title和向右鈕</h2>

<p>預設只有Navigation Controller後第一個Bar可以編輯Title，若要加入新title則要從StoryBoard中拉入<strong>Navigation item</strong>
預設上方並無向右鍵，只有返回鍵，若要加入則拉入<strong>Bar Button Item</strong></p>

<h1 id="tab-bar-controller">Tab Bar Controller</h1>

<p>與Navigation View許多做法類似
想加上新的tab可以
- 方法1: TabViewController綁定View Controllers，有兩種做法
 - 按住Ctrl並將TabViewController拉到想要加上的Controller，鬆開後選擇View Controllers
 - 在TabViewController的Triggered Segue中，指定新的View Controllers
- 方法2: 在StoryBoard中，點擊已經存在的Controller。並從上方選單Editor =&gt; Embed in =&gt; TabViewController即可</p>

<h2 id="tab-bar-controller下的controller們">tab bar controller下的controller們</h2>

<pre><code class="language-swift">self.tabBarController?.viewControllers[0]
self.tabBarController?.viewControllers[1]
...
</code></pre>

<p>要注意的是，如果是tab bar controller下包著navigation controller，在存取時要先轉型成navigation controller，再取用navigation controller裡面的controller，才不會錯誤。</p>

<h2 id="切換tab">切換tab</h2>

<pre><code class="language-swift">self.tabBarController?.selectedIndex = 0
</code></pre>

<h2 id="隱藏tab">隱藏tab</h2>

<pre><code class="language-swift">self.tabBarController?.tabBar.isHidden = true
</code></pre>

<h1 id="在不同的controller之間跳轉">在不同的Controller之間跳轉</h1>

<h2 id="方法1-直接拖拉">方法1 直接拖拉</h2>

<p>在storyboard上
按住ctrl點下來源Controller之button拉到要呈現的Controller後鬆開，選擇show或present即可。
show會在啟用navigation bar的時候自動使用navigation.push，若無navigation bar則是使用present。</p>

<h2 id="方法2-利用segue">方法2 利用segue</h2>

<p>在storyboard上
按住ctrl點下來源Controller，拉到要呈現的Controller，會多一條segue連線，幫此條連線取名字(identifer)
接下來在想切換的情況下使用performSegue即可(參數為剛剛取的identifer)</p>

<pre><code class="language-swift">performSegue(withIdentifier: &quot;goToView2&quot;, sender: nil)
</code></pre>

<h2 id="方法3-指定storyboard以及controller-通常用在更換story-board的時候">方法3 指定StoryBoard以及Controller (通常用在更換Story Board的時候)</h2>

<p>將要呈現的Controller取名字(StoryBoardID)
並在程式碼中指定
1. 位於哪個StoryBoard
2. Controller的StoryBoardID
最後present或push即可</p>

<pre><code class="language-swift">let myStoryBoard = UIStoryboard(name: &quot;Main&quot;, bundle: nil)
let whiteViewController = myStoryBoard.instantiateViewController(withIdentifier: &quot;whiteView&quot;)
present(whiteViewController, animated:true, completion:nil)
</code></pre>

<p>如果是位於同一個storyboard，也可以拿到自己的storyboard</p>

<pre><code class="language-swift">let myStoryBoard = self.storyboard!
let whiteViewController = myStoryBoard.instantiateInitialViewController(withIdentifier: &quot;whiteView&quot;)
present(whiteViewController, animated:true, completion:nil)
</code></pre>

<h2 id="方法4-storyboard-reference-通常用在更換story-board的時候">方法4 StoryBoard Reference (通常用在更換Story Board的時候)</h2>

<p>在StoryBoard中，將StoryBoard Reference
拖到畫面上，指定StoryBoard Reference上的StoryBoard和ControllerID
接下來利用方法1或2拖拉即可成功</p>

<h2 id="方法5-逃生門-通常用在要返回前一個controller的時候">方法5 逃生門 (通常用在要返回前一個Controller的時候)</h2>

<h3 id="情況">情況</h3>

<p>假設最初的controller取名叫parent controller
parent controller可以連到許多child controller
當child controller想返回parent controller的時候</p>

<h3 id="作法">作法</h3>

<p>先寫在parent controller</p>

<pre><code class="language-swift">@IBAction func backToMain(_ segue:UIStoryboardSegue){
    print(&quot;back to main&quot;)
}
</code></pre>

<p>再用StoryBoard選擇child controller
按鈕按住ctrl往該controller的逃生門拉 (上方最右邊的圖示)
即會出現backToMain的方法
如果parent controller在child controller返回後想執行什麼動作也可在此function中填入</p>

<h1 id="controller之間傳遞訊息">Controller之間傳遞訊息</h1>

<h2 id="方法1-利用destination-controller的property-呼叫下一個controller時">方法1. 利用destination controller的property (呼叫下一個Controller時)</h2>

<ol>
<li>複寫Source Controller的prepare Function</li>
<li>參數segue之屬性destionation即為destination controller</li>
<li>強制轉型為destination controller</li>
<li>將其塞入數值</li>
</ol>

<p>這裡要注意的是，不能把值塞進destination controller的UI元件內(Ex: Label)，因為這個時候畫面元件還沒生成。</p>

<pre><code class="language-swift">// Source Controller
override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
    if segue.destination is SecondViewController{
    let des = segue.destination as! SecondViewController
    des.textFromFirstView = &quot;Hello World&quot;
    }
}
</code></pre>

<h2 id="方法2-利用前後階層關係-僅適用於返回controller時">方法2. 利用前後階層關係(僅適用於返回controller時)</h2>

<p>前面有說過present可以靠
- presentingViewController
- presentedViewController</p>

<p>navigation bar可以靠
- self.navigationController?.viewControllers[0]
- self.navigationController?.viewControllers[1]
- &hellip;</p>

<p>來獲得前面的controller元件
取得controller後再參考方法1塞入值</p>

<h2 id="方法3-protocol-返回前一個controller時">方法3. protocol (返回前一個controller時)</h2>

<p>將前一個controller名為FirstViewController
現在這個controller名為SecondViewController
令一個protocol叫做SecondViewControllerDelegate</p>

<ol>
<li>將SecondViewControllerDelegate當作SecondViewController的屬性</li>
<li>在FirstViewController跳轉到SecondViewController前，通過方法1塞進自己實作的SecondViewControllerDelegate</li>
<li>SecondViewController消失前，執行該protocol的method (透過複寫viewWillDisapear來達成)</li>
</ol>

<p>```swift SecondController
var delegate:SecondViewControllerDelegate?
@IBAction func goBack(_ sender: UIButton) {
    let _ = navigationController?.popViewController(animated: true)
}</p>

<p>override func viewWillDisappear(_ animated: Bool) {
  super.viewWillDisappear(animated)
  if self.isMovingFromParentViewController{
        delegate?.setColor(colorType: &ldquo;red&rdquo;)
    }
}</p>

<pre><code>`hint: 可以靠 self.isMovingFromParentViewController來測試是否為返回到前一個Controller`

```swift SecondViewControllerDelegate
protocol SecondViewControllerDelegate{
    func setColor(colorType:String)
}
</code></pre>

<p>```swift FirstViewController (實作SecondViewControllerDelegate)
override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
  if let des = segue.destination as? SecondViewController{
    des.delegate = self
  }
}</p>

<pre><code>
## 方法4. notification (返回前一個controller時)
1. parent controller先監聽事件
    - 撰寫接收到監聽後要執行的function
  - 註冊監聽事件
2. child controller發送notification

```swift ParentController
// 接收到事件後要執行的任務
func getUpdateNoti(noti:Notification) {
    let data = noti.userInfo![&quot;data&quot;] as! String
    print(data)
}

override func viewDidLoad() {
  super.viewDidLoad()
    
  // 註冊事件
  let notificationName = Notification.Name(&quot;GetUpdateNoti&quot;)
  NotificationCenter.default.addObserver(self, selector: #selector(ViewController.getUpdateNoti(noti:)), name: notificationName, object: nil)
}
</code></pre>

<p>```swift ChildController
// 發送事件
let notificationName = Notification.Name(&ldquo;GetUpdateNoti&rdquo;)
NotificationCenter.default().post(name: notificationName,object: nil, userInfo: [&ldquo;data&rdquo;:&ldquo;Hello World&rdquo;])</p>

<pre><code>
## 方法5. 全域變數
在AppDelegate增加property
並在想要使用的class裡面，將UIApplication.shared.delegate轉型為AppDelegate
即可使用裡面的property
```swift
if let appDelegate = UIApplication.shared.delegate as? AppDelegate{
    if let colorName = appDelegate.color{
    setColor(colorType: colorName)
  }
}
</code></pre>

<p>全域變數還有很多做法，像是singleton或是寫在class之外，有機會再開一篇講。</p>

			</div>

			
		</div>

  </body>
</html>
